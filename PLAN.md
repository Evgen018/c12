# План реализации функций кнопок

## Обзор
Добавление AI-обработки для трех кнопок: "О чем статья?", "Тезисы", "Пост для Telegram" с использованием OpenRouter AI API.

## Текущее состояние
- ✅ Парсинг HTML статьи (извлечение title, date, content)
- ✅ Перевод статьи на русский язык
- ✅ Интерфейс с кнопками готов
- ❌ AI-обработка для кнопок "О чем статья?", "Тезисы", "Пост для Telegram" не реализована

## План действий

### 1. Создание API route для AI-обработки
**Файл:** `src/app/api/ai-process/route.ts`

**Шаги:**
1. Создать новый API route `/api/ai-process`
2. Принимать параметры:
   - `content` - текст статьи для обработки
   - `mode` - тип обработки: "about" | "thesis" | "telegram"
3. Использовать OpenRouter API с моделью `mistralai/devstral-2512:free`
4. Для каждого режима формировать соответствующий промпт:
   - **"about"**: "Напиши краткое описание статьи (2-3 абзаца). О чем эта статья? Какие основные идеи она содержит?"
   - **"thesis"**: "Извлеки основные тезисы статьи и представь их в виде нумерованного списка. Каждый тезис должен быть кратким и содержательным."
   - **"telegram"**: "Создай готовый пост для Telegram на основе статьи. Пост должен быть интересным, информативным и подходить для публикации в Telegram-канале. Используй эмодзи для оформления."
5. Возвращать результат обработки

### 2. Обновление клиентского кода
**Файл:** `src/app/page.tsx`

**Шаги:**
1. Обновить функцию `handleAction`:
   - После успешного парсинга статьи проверять режим (`about`, `thesis`, `telegram`)
   - Если режим не `translate`, вызывать `/api/ai-process` с извлеченным контентом
   - Передавать в API: `content` и `mode`
2. Обработать ответ от AI и отобразить в поле результата
3. Добавить обработку ошибок для AI-запросов

### 3. Обработка ошибок и валидация
**Шаги:**
1. Проверять наличие контента перед отправкой в AI
2. Ограничить длину контента для AI (если статья слишком длинная)
3. Добавить информативные сообщения об ошибках
4. Логировать ошибки для отладки

### 4. Оптимизация промптов
**Шаги:**
1. Протестировать промпты для каждого режима
2. Настроить промпты для получения качественных результатов
3. Убедиться, что ответы на русском языке
4. Оптимизировать длину ответов (особенно для Telegram)

### 5. Тестирование
**Шаги:**
1. Протестировать каждую кнопку с реальными статьями
2. Проверить обработку ошибок (нет контента, ошибка API и т.д.)
3. Проверить работу на Vercel (production)
4. Убедиться, что переменная окружения `OPENROUTER_API_KEY` настроена

## Порядок реализации

1. **Создать API route** `/api/ai-process` с базовой логикой
2. **Добавить промпты** для каждого режима обработки
3. **Интегрировать** в клиентский код (`handleAction`)
4. **Добавить обработку ошибок** и валидацию
5. **Протестировать** все три режима
6. **Оптимизировать** промпты на основе результатов тестирования

## Технические детали

### Структура запроса к OpenRouter:
```typescript
{
  model: "mistralai/devstral-2512:free",
  messages: [
    {
      role: "system",
      content: "[промпт в зависимости от режима]"
    },
    {
      role: "user",
      content: "[контент статьи]"
    }
  ]
}
```

### Ограничения:
- Максимальная длина контента для AI: ~30000 символов
- Все ответы должны быть на русском языке
- Telegram пост должен быть готовым к публикации (с эмодзи, форматированием)

## Зависимости
- OpenRouter API (уже настроен для перевода)
- Переменная окружения: `OPENROUTER_API_KEY` (уже настроена)

